==============
Supervisor.py
==============

Python —Å–∫—Ä–∏–ø—Ç –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ Odoo –º–æ–¥—É–ª–∏ –∏ –¥–æ–±–∞–≤–∫–∏
================================================================

–ü—Ä–µ–≥–ª–µ–¥
-------

``supervisor.py`` –µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ –Ω–∞—Å—Ç—Ä–æ–π–≤–∞–Ω–µ –Ω–∞ Odoo –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏ —Å —Ä–∞–∑–ª–∏—á–Ω–∏ —Ç–∏–ø–æ–≤–µ –¥–æ–±–∞–≤–∫–∏.
–ü—Ä–æ–µ–∫—Ç–∏—Ä–∞–Ω –µ –∑–∞ —Ä–∞–±–æ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∏ —Å—Ä–µ–¥–∏ –∏ –ø–æ–¥–¥—ä—Ä–∂–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ OCA –º–æ–¥—É–ª–∏, Enterprise –¥–æ–±–∞–≤–∫–∏ –∏
–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ä–∞–∑—à–∏—Ä–µ–Ω–∏—è.

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
--------------

* üîß **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–≤–∞–Ω–µ** - –ü—ä–ª–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ Odoo —Å—Ä–µ–¥–∞
* üì¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–∞–∫–µ—Ç–∏** - –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –∏ –¥–µ–∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* üîó **–°–∏–º–≤–æ–ª–Ω–∏ –≤—Ä—ä–∑–∫–∏** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ symlinks –∑–∞ –º–æ–¥—É–ª–∏
* üåê **OCA –ø–æ–¥–¥—Ä—ä–∂–∫–∞** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Open Community Association —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
* üè¢ **Enterprise –º–æ–¥—É–ª–∏** - –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –∑–∞ –æ—Ñ–∏—Ü–∏–∞–ª–Ω–∏ Odoo Enterprise –¥–æ–±–∞–≤–∫–∏
* üê≥ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç** - –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω –∑–∞ Docker/Kubernetes —Å—Ä–µ–¥–∏
* üîê **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∞–≤–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–≤–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª–æ–≤–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ
-----------

–°–∫—Ä–∏–ø—Ç—ä—Ç –Ω–µ –∏–∑–∏—Å–∫–≤–∞ —Å–ø–µ—Ü–∏–∞–ª–Ω–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è. –ü—Ä–æ—Å—Ç–æ –∏–∑—Ç–µ–≥–ª–µ—Ç–µ —Ñ–∞–π–ª–∞ –∏ –≥–æ –Ω–∞–ø—Ä–∞–≤–µ—Ç–µ –∏–∑–ø—ä–ª–Ω–∏–º:

.. code-block:: bash

   chmod +x supervisor.py

–ò–∑–∏—Å–∫–≤–∞–Ω–∏—è
----------

* Python 3.11+
* Git
* –ü—Ä–∞–≤–∞ –∑–∞ –ø–∏—Å–∞–Ω–µ –≤ —Å–∏—Å—Ç–µ–º–Ω–∏—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
* –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—Ä—ä–∑–∫–∞ –∑–∞ –∏–∑—Ç–µ–≥–ª—è–Ω–µ –Ω–∞ –º–æ–¥—É–ª–∏

–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ
----------

–û—Å–Ω–æ–≤–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
~~~~~~~~~~~~~~~~

.. code-block:: bash

   python3 supervisor.py <–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–µ–Ω_—Ñ–∞–π–ª> [–æ–ø—Ü–∏–∏]

–ü—Ä–∏–º–µ—Ä–∏
~~~~~~~

**–û—Å–Ω–æ–≤–Ω–∞ —É–ø–æ—Ç—Ä–µ–±–∞:**

.. code-block:: bash

   python3 supervisor.py /path/to/addons.conf

**–° OCA –¥–æ–±–∞–≤–∫–∏:**

.. code-block:: bash

   python3 supervisor.py /path/to/addons.conf --addons-oca

**–° Enterprise –º–æ–¥—É–ª–∏:**

.. code-block:: bash

   python3 supervisor.py /path/to/addons.conf --addons-–µ–µ

**Init container —Ä–µ–∂–∏–º:**

.. code-block:: bash

   python3 supervisor.py /path/to/addons.conf --init-container

–ö–æ–º–∞–Ω–¥–Ω–∏ –æ–ø—Ü–∏–∏
--------------

.. list-table::
   :header-rows: 1

   * - –û–ø—Ü–∏—è
     - –û–ø–∏—Å–∞–Ω–∏–µ
   * - ``-a, --odoo-addons-oca``
     - –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞ OCA –¥–æ–±–∞–≤–∫–∏
   * - ``-r, --odoo-addons``
     - –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞ Odoo –¥–æ–±–∞–≤–∫–∏
   * - ``-s, --source-dir``
     - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏–∑—Ç–æ—á–Ω–∏–∫ –∑–∞ –¥–æ–±–∞–≤–∫–∏—Ç–µ
   * - ``-t, --target-dir``
     - –¶–µ–ª–µ–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞ –¥–æ–±–∞–≤–∫–∏—Ç–µ
   * - ``--addons-oca``
     - –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞ –≤—Å–∏—á–∫–∏ OCA –¥–æ–±–∞–≤–∫–∏
   * - ``--force-update``
     - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞
   * - ``--addons-–µ–µ``
     - –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞ Enterprise –¥–æ–±–∞–≤–∫–∏
   * - ``--init-container``
     - –ê–∫—Ç–∏–≤–∏—Ä–∞ —Å—Ç—Ä–æ–≥ —Ä–µ–∂–∏–º –∑–∞ init –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   * - ``-u, --uid``
     - UID –Ω–∞ Odoo –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
   * - ``-g, --gid``
     - GID –Ω–∞ Odoo –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ
-------------

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∏—è—Ç —Ñ–∞–π–ª –∏–∑–ø–æ–ª–∑–≤–∞ INI —Ñ–æ—Ä–º–∞—Ç:

.. code-block:: ini

   [global]
   force_update = true
   use_requirements = true

   [symlinks]
   source_dir = /opt/odoo/odoo-18.0
   target_dir = /var/lib/odoo/.local/share/Odoo/addons/18.0
   priority = base,web,mail

   [github]
   username = your_github_user
   email = your_email@example.com
   password = your_github_token

   [odoo]
   username = your_odoo_user
   password = your_odoo_password

   [apps.odoo.com]
   username = your_apps_user
   password = your_apps_password

   [owner]
   uid = 100
   gid = 100

   [addons]
   use_oca = true
   odoo_addons_oca = account-analytic,server-tools
   use_ee = false

   [uninstall]
   python_package = deprecated-package1,old-package2

–ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –Ω–∞ —Å—Ä–µ–¥–∞—Ç–∞
---------------------

.. list-table::
   :header-rows: 1

   * - –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∞
     - –û–ø–∏—Å–∞–Ω–∏–µ
     - –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
   * - ``ODOO_BRANCH``
     - –í–µ—Ä—Å–∏—è –Ω–∞ Odoo –∫–ª–æ–Ω–∞
     - ``18.0``
   * - ``ODOO_INIT_CONTAINER``
     - –ê–∫—Ç–∏–≤–∏—Ä–∞ init —Ä–µ–∂–∏–º
     - ``false``

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
--------------------------

* **Odoo –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**: ``/var/lib/odoo``
* **Opt –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**: ``/opt/odoo``
* **Python —Ü–µ–ª**: ``/opt/python3``
* **–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –¥–æ–±–∞–≤–∫–∏**: ``/mnt/extra-addons``

–†–µ–∂–∏–º–∏ –Ω–∞ —Ä–∞–±–æ—Ç–∞
----------------

–û–±–∏–∫–Ω–æ–≤–µ–Ω —Ä–µ–∂–∏–º
~~~~~~~~~~~~~~~

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ —Å—ä—Å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª–Ω–æ –æ–±—Ä–∞–±–æ—Ç–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∏. –°–∫—Ä–∏–ø—Ç—ä—Ç —â–µ –ø—Ä–æ–¥—ä–ª–∂–∏
–¥–∞ —Ä–∞–±–æ—Ç–∏ –¥–æ—Ä–∏ –ø—Ä–∏ –≤—ä–∑–Ω–∏–∫–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∏ –≤ –æ—Ç–¥–µ–ª–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.

Init Container —Ä–µ–∂–∏–º
~~~~~~~~~~~~~~~~~~~~

–ê–∫—Ç–∏–≤–∏—Ä–∞ —Å–µ —Å ``--init-container`` –∏–ª–∏ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞—Ç–∞ ``ODOO_INIT_CONTAINER``.
–í —Ç–æ–∑–∏ —Ä–µ–∂–∏–º:

* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞—Ç requirements
* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞ force_update
* –°–∫—Ä–∏–ø—Ç—ä—Ç –ø—Ä–µ–∫—Ä–∞—Ç—è–≤–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ –ø—Ä–∏ –ø—ä—Ä–≤–∞ –≥—Ä–µ—à–∫–∞ (fail-fast)

Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
-----------------

–ü—Ä–∏–º–µ—Ä Dockerfile:

.. code-block:: docker

   FROM python:3.11-slim

   COPY supervisor.py /usr/local/bin/
   COPY addons.conf /etc/odoo/

   RUN chmod +x /usr/local/bin/supervisor.py

   # Init –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   CMD ["/usr/local/bin/supervisor.py", "/etc/odoo/addons.conf", "--init-container"]

Kubernetes –ø—Ä–∏–º–µ—Ä:

.. code-block:: yaml

   apiVersion: v1
   kind: Pod
   spec:
     initContainers:
     - name: odoo-setup
       image: your-supervisor-image:latest
       command: ["/usr/local/bin/supervisor.py"]
       args: ["/etc/odoo/addons.conf", "--init-container"]
       env:
       - name: ODOO_BRANCH
         value: "18.0"
       - name: ODOO_INIT_CONTAINER
         value: "true"

–û—Ç—Å—Ç—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏
------------------------

–û–±—â–∏ –ø—Ä–æ–±–ª–µ–º–∏
~~~~~~~~~~~~~

**–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–æ—Å—Ç—ä–ø:**

.. code-block:: bash

   sudo chown -R odoo:odoo /var/lib/odoo
   sudo chmod -R 755 /var/lib/odoo

**Git –≥—Ä–µ—à–∫–∏:**

.. code-block:: bash

   # –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—Ä—ä–∑–∫–∞—Ç–∞
   git config --global http.sslverify false  # –°–∞–º–æ –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ

**Python –ø–∞–∫–µ—Ç–∏:**

.. code-block:: bash

   pip install --upgrade pip
   pip install --no-cache-dir -r requirements.txt

–õ–æ–≥–æ–≤–µ
~~~~~~

–°–∫—Ä–∏–ø—Ç—ä—Ç –≥–µ–Ω–µ—Ä–∏—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω–∏ –ª–æ–≥–æ–≤–µ. –ó–∞ –ø–æ–≤–µ—á–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–±–∞–≤–µ—Ç–µ:

.. code-block:: bash

   python3 supervisor.py config.conf --verbose 2>&1 | tee supervisor.log

–ü—Ä–∏–Ω–æ—Å
------

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∞–º–µ –≤–∞—à–∏—è –ø—Ä–∏–Ω–æ—Å! –ú–æ–ª—è:

1. Fork-–Ω–µ—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –°—ä–∑–¥–∞–π—Ç–µ feature branch
3. Commit-–Ω–µ—Ç–µ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
4. Push-–Ω–µ—Ç–µ –∫—ä–º branch-–∞
5. –°—ä–∑–¥–∞–π—Ç–µ Pull Request

–õ–∏—Ü–µ–Ω–∑
------

–¢–æ–∑–∏ –ø—Ä–æ–µ–∫—Ç –µ –ª–∏—Ü–µ–Ω–∑–∏—Ä–∞–Ω –ø–æ–¥ MIT –ª–∏—Ü–µ–Ω–∑–∞ - –≤–∏–∂—Ç–µ LICENSE —Ñ–∞–π–ª–∞ –∑–∞ –¥–µ—Ç–∞–π–ª–∏.

–ü–æ–¥–¥—Ä—ä–∂–∫–∞
---------

–ó–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏ –ø–æ–¥–¥—Ä—ä–∂–∫–∞:

* –°—ä–∑–¥–∞–π—Ç–µ issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—Ç–æ
* –ü–∏—à–µ—Ç–µ –Ω–∞ email: support@example.com
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.example.com

–í–µ—Ä—Å–∏–∏
------

* **v1.0.0** - –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∞ –≤–µ—Ä—Å–∏—è
* **v1.1.0** - –î–æ–±–∞–≤–µ–Ω–∞ Enterprise –ø–æ–¥–¥—Ä—ä–∂–∫–∞
* **v1.2.0** - Init container —Ä–µ–∂–∏–º
* **v1.3.0** - –ü–æ–¥–æ–±—Ä–µ–Ω–∞ OCA –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ê–≤—Ç–æ—Ä–∏
------

* **–û—Å–Ω–æ–≤–µ–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫** - –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∞ —Ä–∞–±–æ—Ç–∞
* **–û–±—â–Ω–æ—Å—Ç** - –†–∞–∑–ª–∏—á–Ω–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è –∏ –ø–æ–ø—Ä–∞–≤–∫–∏

–í–∏–∂—Ç–µ –ø—ä–ª–Ω–∏—è —Å–ø–∏—Å—ä–∫ —Å `contributors <https://github.com/rosenvladimirov/supervisor/contributors>`_.